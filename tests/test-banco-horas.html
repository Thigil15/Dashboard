<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Banco de Horas</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #0054B4;
            border-bottom: 3px solid #0054B4;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case {
            padding: 12px;
            margin: 8px 0;
            border-left: 4px solid #ddd;
            background: #f9f9f9;
        }
        .test-case.pass {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .test-case.fail {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .test-result {
            font-weight: bold;
            margin-top: 5px;
        }
        .pass .test-result { color: #155724; }
        .fail .test-result { color: #721c24; }
        code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .summary {
            background: #0054B4;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 18px;
        }
        button {
            background: #0054B4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #003d8f;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste do Sistema de Banco de Horas</h1>
    
    <div class="test-section">
        <h2>Informa√ß√µes do Teste</h2>
        <p>Este teste valida a fun√ß√£o <code>_esc_calculateHours()</code> que calcula as horas de trabalho baseado nos c√≥digos de turno.</p>
        <p><strong>C√≥digos esperados:</strong></p>
        <ul>
            <li><code>M</code> ou <code>Manh√£</code> = 5 horas (07:00-12:00)</li>
            <li><code>T</code> ou <code>Tarde</code> = 5 horas (13:00-18:00)</li>
            <li><code>N</code> ou <code>Noite</code> = 12 horas (19:00-07:00)</li>
            <li><code>GPS</code>, <code>AB</code>, <code>m√©todo</code> = 5 horas</li>
            <li>Hor√°rios completos: <code>7h √†s 12h</code> = calculado</li>
        </ul>
        <button onclick="runTests()">‚ñ∂Ô∏è Executar Testes</button>
    </div>

    <div id="results"></div>
    <div id="summary" class="summary" style="display:none;"></div>

    <script>
        // Constants (same as in script.js)
        const HOURS_BANK_CONSTANTS = {
            PLANTAO_HOURS: 12,
            NOTURNO_HOURS: 12,
            NORMAL_PRACTICE_HOURS: 5,
            AULA_HOURS: 5
        };

        const TIME_FORMAT_FULL_REGEX = /(\d{1,2}):(\d{2})(?::\d{2})?\s*(?:√†s|as|a|-)\s*(\d{1,2}):(\d{2})(?::\d{2})?/i;

        // Simplified version of _esc_calculateHours for testing
        function _esc_calculateHours(rawText) {
            if (!rawText) return { hours: 0, standardHours: 0, startTime: '', endTime: '', isPlantao: false, isNoturno: false, isAula: false };
            
            const rawTextLower = rawText.toLowerCase().trim();
            const rawTextUpper = rawText.toUpperCase().trim();
            
            // Check for shorthand codes first (M, T, N, GPS, AB, etc.)
            if (rawTextUpper === 'M' || rawTextUpper.startsWith('M ') || rawTextUpper.startsWith('M-') || 
                rawTextLower.includes('manh√£') || rawTextLower.includes('manha')) {
                return { hours: 5, standardHours: HOURS_BANK_CONSTANTS.NORMAL_PRACTICE_HOURS, startTime: '07:00', endTime: '12:00', isPlantao: false, isNoturno: false, isAula: false };
            }
            if (rawTextUpper === 'T' || rawTextUpper.startsWith('T ') || rawTextUpper.startsWith('T-') || 
                rawTextLower.includes('tarde')) {
                return { hours: 5, standardHours: HOURS_BANK_CONSTANTS.NORMAL_PRACTICE_HOURS, startTime: '13:00', endTime: '18:00', isPlantao: false, isNoturno: false, isAula: false };
            }
            if (rawTextUpper === 'N' || rawTextUpper.startsWith('N ') || rawTextUpper.startsWith('N-') || 
                rawTextLower.includes('noite') || rawTextLower.includes('noturno')) {
                return { hours: 12, standardHours: HOURS_BANK_CONSTANTS.NOTURNO_HOURS, startTime: '19:00', endTime: '07:00', isPlantao: false, isNoturno: true, isAula: false };
            }
            if (rawTextUpper.includes('GPS') || rawTextUpper.includes('AB') || rawTextLower.includes('metodo') || rawTextLower.includes('m√©todo')) {
                return { hours: 5, standardHours: HOURS_BANK_CONSTANTS.NORMAL_PRACTICE_HOURS, startTime: '', endTime: '', isPlantao: false, isNoturno: false, isAula: false };
            }
            
            const isAula = rawTextLower.includes('aula') || rawTextLower.includes('hcx') || rawTextLower.includes('inicial');
            
            let match = rawText.match(TIME_FORMAT_FULL_REGEX);
            let isFullTimeFormat = !!match;
            
            if (!match) {
                const s = rawText.replace(/(\d{1,2})h(\d{2})?/g, '$1:$2').replace(/h/g, ':00'); 
                const regex = /(\d{1,2}):?(\d{0,2})\s*(-|√†s|as|a)\s*(\d{1,2}):?(\d{0,2})/i;
                match = s.match(regex);
                isFullTimeFormat = false;
            }

            if (!match) {
                if (isAula) {
                    return { hours: HOURS_BANK_CONSTANTS.AULA_HOURS, standardHours: HOURS_BANK_CONSTANTS.AULA_HOURS, startTime: '', endTime: '', isPlantao: false, isNoturno: false, isAula: true };
                }
                return { hours: 0, standardHours: 0, startTime: '', endTime: '', isPlantao: false, isNoturno: false, isAula: false }; 
            }

            let h1, m1, h2, m2;
            
            if (isFullTimeFormat) {
                h1 = parseInt(match[1], 10);
                m1 = parseInt(match[2] || '0', 10);
                h2 = parseInt(match[3], 10);
                m2 = parseInt(match[4] || '0', 10);
            } else {
                h1 = parseInt(match[1], 10);
                m1 = parseInt(match[2] || '0', 10);
                h2 = parseInt(match[4], 10);
                m2 = parseInt(match[5] || '0', 10);
            }

            if (isNaN(h1) || isNaN(h2)) {
                if (isAula) {
                    return { hours: HOURS_BANK_CONSTANTS.AULA_HOURS, standardHours: HOURS_BANK_CONSTANTS.AULA_HOURS, startTime: '', endTime: '', isPlantao: false, isNoturno: false, isAula: true };
                }
                return { hours: 0, standardHours: 0, startTime: '', endTime: '', isPlantao: false, isNoturno: false, isAula: false };
            }

            const d1 = new Date(2000, 0, 1, h1, m1);
            const d2 = new Date(2000, 0, 1, h2, m2);
            let diff = (d2.getTime() - d1.getTime()) / (1000 * 60 * 60);

            if (diff < 0) { diff += 24; }
            
            const startTime = `${String(h1).padStart(2, '0')}:${String(m1).padStart(2, '0')}`;
            const endTime = `${String(h2).padStart(2, '0')}:${String(m2).padStart(2, '0')}`;
            
            const isNoturno = h1 >= 19 && h2 <= 8;
            const isPlantao = diff >= 11 && diff <= 13;
            
            let standardHours = diff;
            
            if (isPlantao || isNoturno) {
                standardHours = HOURS_BANK_CONSTANTS.PLANTAO_HOURS;
            } else if (isAula) {
                standardHours = HOURS_BANK_CONSTANTS.AULA_HOURS;
            } else if (diff >= 4 && diff <= 6) {
                standardHours = HOURS_BANK_CONSTANTS.NORMAL_PRACTICE_HOURS;
            }
            
            return { hours: diff, standardHours, startTime, endTime, isPlantao, isNoturno, isAula };
        }

        function runTests() {
            const tests = [
                // Shift codes
                { input: 'M', expected: { hours: 5, standardHours: 5, startTime: '07:00', endTime: '12:00' }, desc: 'C√≥digo M (Manh√£)' },
                { input: 'T', expected: { hours: 5, standardHours: 5, startTime: '13:00', endTime: '18:00' }, desc: 'C√≥digo T (Tarde)' },
                { input: 'N', expected: { hours: 12, standardHours: 12, startTime: '19:00', endTime: '07:00' }, desc: 'C√≥digo N (Noite)' },
                
                // Shift codes with status
                { input: 'M - Falta', expected: { hours: 5, standardHours: 5 }, desc: 'M com falta' },
                { input: 'T Ausencia', expected: { hours: 5, standardHours: 5 }, desc: 'T com aus√™ncia' },
                { input: 'N-Falta', expected: { hours: 12, standardHours: 12 }, desc: 'N com falta' },
                
                // Full words
                { input: 'Manh√£', expected: { hours: 5, standardHours: 5 }, desc: 'Palavra completa Manh√£' },
                { input: 'Tarde', expected: { hours: 5, standardHours: 5 }, desc: 'Palavra completa Tarde' },
                { input: 'Noite', expected: { hours: 12, standardHours: 12 }, desc: 'Palavra completa Noite' },
                
                // Methods
                { input: 'GPS', expected: { hours: 5, standardHours: 5 }, desc: 'M√©todo GPS' },
                { input: 'AB', expected: { hours: 5, standardHours: 5 }, desc: 'M√©todo AB' },
                { input: 'GPS AB', expected: { hours: 5, standardHours: 5 }, desc: 'M√©todo GPS AB' },
                
                // Time ranges
                { input: '7h √†s 12h', expected: { hours: 5, standardHours: 5 }, desc: 'Hor√°rio 7h √†s 12h' },
                { input: '8h as 13h', expected: { hours: 5, standardHours: 5 }, desc: 'Hor√°rio 8h as 13h' },
                { input: '19h √†s 7h', expected: { hours: 12, standardHours: 12, isNoturno: true }, desc: 'Hor√°rio noturno 19h √†s 7h' },
                
                // Aulas
                { input: 'Aula Inicial', expected: { hours: 5, standardHours: 5, isAula: true }, desc: 'Aula Inicial' },
                { input: 'HCX', expected: { hours: 5, standardHours: 5, isAula: true }, desc: 'HCX' },
                
                // Empty/invalid
                { input: '', expected: { hours: 0, standardHours: 0 }, desc: 'C√©lula vazia' },
                { input: 'Falta', expected: { hours: 0, standardHours: 0 }, desc: 'Apenas Falta (sem turno)' },
                { input: 'Folga', expected: { hours: 0, standardHours: 0 }, desc: 'Folga' }
            ];

            let passed = 0;
            let failed = 0;
            let resultsHTML = '';

            tests.forEach((test, index) => {
                const result = _esc_calculateHours(test.input);
                let isPass = true;
                let details = '';

                // Check expected values
                for (let key in test.expected) {
                    if (result[key] !== test.expected[key]) {
                        isPass = false;
                        details += `<br>‚ùå ${key}: esperado ${test.expected[key]}, obtido ${result[key]}`;
                    }
                }

                if (isPass) {
                    passed++;
                    resultsHTML += `
                        <div class="test-case pass">
                            <strong>‚úÖ Teste ${index + 1}: ${test.desc}</strong>
                            <br>Input: <code>${test.input || '(vazio)'}</code>
                            <br>Horas: ${result.standardHours}h
                            ${result.startTime && result.endTime ? `<br>Hor√°rio: ${result.startTime} - ${result.endTime}` : ''}
                            <div class="test-result">PASSOU</div>
                        </div>
                    `;
                } else {
                    failed++;
                    resultsHTML += `
                        <div class="test-case fail">
                            <strong>‚ùå Teste ${index + 1}: ${test.desc}</strong>
                            <br>Input: <code>${test.input || '(vazio)'}</code>
                            ${details}
                            <div class="test-result">FALHOU</div>
                        </div>
                    `;
                }
            });

            const summaryEl = document.getElementById('summary');
            const resultsEl = document.getElementById('results');
            
            resultsEl.innerHTML = `
                <div class="test-section">
                    <h2>Resultados dos Testes</h2>
                    ${resultsHTML}
                </div>
            `;

            summaryEl.innerHTML = `
                <strong>üìä Resumo:</strong> ${passed} passou${passed !== 1 ? 'ram' : 'u'}, ${failed} falhou${failed !== 1 ? 'ram' : ''}
                <br>Taxa de sucesso: ${((passed / tests.length) * 100).toFixed(1)}%
            `;
            summaryEl.style.display = 'block';

            // Scroll to results
            resultsEl.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
