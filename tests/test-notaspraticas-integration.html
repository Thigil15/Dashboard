<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de IntegraÃ§Ã£o - NotasPraticas</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            padding: 40px 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2rem;
        }
        .np-module-card-pro {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .np-competencies-section-pro {
            margin-top: 30px;
        }
        .np-competencies-header-pro {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
        }
        .np-discipline-item-pro {
            margin-bottom: 20px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid var(--np-discipline-color, #0891B2);
        }
        .np-discipline-header-pro {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .np-discipline-name-pro {
            font-weight: 500;
            color: #334155;
            font-size: 0.95rem;
        }
        .np-discipline-value-pro {
            font-size: 1.25rem;
            font-weight: 700;
        }
        .np-discipline-progress-pro {
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        .np-discipline-fill-pro {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .test-info {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .test-info h3 {
            margin-top: 0;
            color: #92400e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ§ª Teste de IntegraÃ§Ã£o: NotasPraticas Rendering</h1>
            <p>SimulaÃ§Ã£o de como os campos reais serÃ£o exibidos na interface</p>
        </div>

        <div class="test-info">
            <h3>ðŸ“‹ Sobre Este Teste</h3>
            <p>Este teste simula exatamente como os campos do NotasPraticas serÃ£o renderizados na interface real do sistema, 
            usando os mesmos estilos CSS e a mesma funÃ§Ã£o <code>splitConcatenatedFieldName()</code> que estÃ¡ em <code>script.js</code>.</p>
            <p><strong>Dados de teste:</strong> Usando os nomes de colunas reais fornecidos no issue.</p>
        </div>

        <div id="content-area"></div>
    </div>

    <script>
        // Copy the actual splitConcatenatedFieldName function from script.js
        function splitConcatenatedFieldName(fieldName) {
            if (!fieldName || typeof fieldName !== 'string') return fieldName;
            if (fieldName.length < 20 || fieldName.includes(' ')) {
                return fieldName;
            }
            let result = fieldName.replace(/([a-z])([A-Z])/g, '$1 $2');
            result = result.replace(/([A-Z])([A-Z][a-z])/g, '$1 $2');
            result = result
                .replace(/\bDa\b/g, 'da')
                .replace(/\bDe\b/g, 'de')
                .replace(/\bDo\b/g, 'do')
                .replace(/\bDos\b/g, 'dos')
                .replace(/\bDas\b/g, 'das')
                .replace(/\bE\b/g, 'e')
                .replace(/\bA\b/g, 'a')
                .replace(/\bO\b/g, 'o')
                .replace(/\bNa\b/g, 'na')
                .replace(/\bNo\b/g, 'no')
                .replace(/\bNos\b/g, 'nos')
                .replace(/\bNas\b/g, 'nas')
                .replace(/\bEm\b/g, 'em')
                .replace(/\bPor\b/g, 'por')
                .replace(/\bCom\b/g, 'com')
                .replace(/\bPara\b/g, 'para')
                .replace(/\bQue\b/g, 'que');
            
            const words = result.split(/\s+/);
            
            if (words.length < 4) {
                result = words.join(' ');
            } else {
                const lowerWords = words.map(w => w.toLowerCase());
                
                for (let phraseLen = 6; phraseLen >= 2; phraseLen--) {
                    for (let i = 0; i <= words.length - phraseLen * 2; i++) {
                        const phrase1 = lowerWords.slice(i, i + phraseLen).join(' ');
                        
                        for (let j = i + phraseLen; j <= words.length - phraseLen; j++) {
                            const phrase2 = lowerWords.slice(j, j + phraseLen).join(' ');
                            
                            if (phrase1 === phrase2) {
                                words.splice(j, phraseLen);
                                lowerWords.splice(j, phraseLen);
                                j--;
                            }
                        }
                    }
                }
                
                result = words.join(' ');
            }
            
            if (result.length > 100) {
                const truncated = result.substring(0, 97);
                const lastSpace = truncated.lastIndexOf(' ');
                if (lastSpace > 70) {
                    result = truncated.substring(0, lastSpace) + '...';
                } else {
                    result = truncated + '...';
                }
            }
            return result.trim();
        }

        function formatarNota(nota) {
            return typeof nota === 'number' ? nota.toFixed(1) : String(nota);
        }

        // Simulate actual NotasPraticas data with the real column names from the issue
        const mockNotasData = {
            "AspiracaoNasotraquealQuantoARealizacaoDaAspiracaoNasotraquealDeFormaSeguraEEficazOAlunoRealizaOProcedimentoComQueNivelDeAuxilio": 9.5,
            "AspiracaoEndotraquealQuantoARealizacaoDaAspiracaoEndotraquealDeFormaSeguraEEficazOAlunoRealizaOProcedimentoComQueNivelDeAuxilio": 8.8,
            "InstalacaoDeOxigenioAssinaleOOsItensQueOAlunoFoiCapazDeIndicarEInstalarDeFormaSeguraEEficaz": 10.0,
            "TecnicasFisioterapeuticasRespiratoriasOAlunoPrecisouDeQueNivelDeAuxilioParaRealizarEfetivamenteAsTecnicasFisioterapeuticas": 8.2,
            "MobilizacaoEPosicionamentoOAlunoPrecisouDeQueNivelDeAuxilioParaAplicarAsTecnicasApropriadasDeMobilizacaoDosPacientes": 9.0,
            "AvaliacaoFisioterapeuticaOAlunoFoiCapazDeRealizarAAvaliacaoCompletaDosPacientes": 8.5,
            "RegistroEDocumentacaoOAlunoEfetuouRegistrosEDocumentouAsIntervencoesRealizadasDeFormaAdequada": 9.2,
            "ComunicacaoInterprofissionalOAlunoManteveUmaComunicacaoEficazComOutrosProfissionaisDeSaude": 10.0,
            "SegurancaEProtocolosOAlunoSeguiuOsProtocolosDeSegurancaDuranteAsAtividades": 9.8,
            "AdaptacaoDePlanosDeTratamentoOAlunoFoiCapazDeAdaptarOsPlanosDeTratamentoDeAcordoComAsNecessidadesDosPacientes": 8.0
        };

        // Simulate the actual rendering as it appears in renderTabNotasPraticas
        const GRADE_MAX_VALUE = 12;
        const EXCELLENCE_THRESHOLD = 9.0;
        const VERY_GOOD_THRESHOLD = 7.0;

        const numericalScores = [];
        
        Object.entries(mockNotasData).forEach(([key, value]) => {
            numericalScores.push({ label: key, value: value });
        });

        numericalScores.sort((a, b) => b.value - a.value);

        let html = `
            <div class="np-module-card-pro">
                <h2 style="color: #0033A0; margin-top: 0;">ðŸ“Š AvaliaÃ§Ã£o PrÃ¡tica - MÃ³dulo 01</h2>
                <p style="color: #64748b; margin-bottom: 30px;">VisualizaÃ§Ã£o dos campos formatados com a correÃ§Ã£o aplicada</p>
                
                <div class="np-competencies-section-pro">
                    <div class="np-competencies-header-pro">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 24px; height: 24px;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        <span>Desempenho por CompetÃªncia</span>
                    </div>
                    ${numericalScores.map((score, idx) => {
                        const percentage = (score.value / GRADE_MAX_VALUE) * 100;
                        let scoreColor = '#0891B2';
                        if (score.value >= EXCELLENCE_THRESHOLD) scoreColor = '#059669';
                        else if (score.value >= VERY_GOOD_THRESHOLD) scoreColor = '#0891B2';
                        else scoreColor = '#f59e0b';
                        
                        const displayLabel = splitConcatenatedFieldName(score.label);
                        
                        return `
                            <div class="np-discipline-item-pro" style="--np-discipline-color: ${scoreColor};">
                                <div class="np-discipline-header-pro">
                                    <span class="np-discipline-name-pro" title="${score.label}">
                                        ${idx + 1}. ${displayLabel}
                                    </span>
                                    <span class="np-discipline-value-pro" style="color: ${scoreColor};">
                                        ${formatarNota(score.value)}
                                    </span>
                                </div>
                                <div class="np-discipline-progress-pro">
                                    <div class="np-discipline-fill-pro" style="width: ${percentage}%; background: ${scoreColor};"></div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="margin-top: 30px; padding: 20px; background: #f0fdf4; border-radius: 12px; border-left: 4px solid #10b981;">
                    <h3 style="color: #059669; margin-top: 0;">âœ… CorreÃ§Ã£o Aplicada Com Sucesso</h3>
                    <ul style="color: #065f46; margin: 0; padding-left: 20px;">
                        <li>Frases repetidas foram removidas automaticamente</li>
                        <li>Labels mais legÃ­veis e completos (atÃ© 100 caracteres)</li>
                        <li>Truncamento inteligente em limites de palavra</li>
                        <li>Todas as notas exibidas corretamente</li>
                    </ul>
                </div>
            </div>
        `;

        document.getElementById('content-area').innerHTML = html;

        console.log('âœ… Integration test loaded successfully');
        console.log('ðŸ“Š Rendered', numericalScores.length, 'competency items');
        console.log('ðŸŽ¯ All field names processed through splitConcatenatedFieldName()');
    </script>
</body>
</html>
